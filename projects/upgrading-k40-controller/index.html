<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="chrome=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content="A Blog on Hardware and Software Development"><meta property="twitter:site" content="@huynle"><meta property="twitter:title" content="Upgrading K40 Controller"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:image" content="https://www.huynle.com/img/banner.png"><meta property="twitter:description" content="Upgrade K40 laser to Smoothieware Controller Board MKS SBASE V1.3 32bit Controller, using GRBL-LPC firmware"><title>Huy Le - Upgrading K40 Controller</title><link rel=canonical href=https://www.huynle.com/projects/upgrading-k40-controller/><meta name=viewport content="user-scalable=no,width=device-width,initial-scale=1,maximum-scale=1"><script type=text/javascript src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js></script><link href=https://unpkg.com/nanogallery2/dist/css/nanogallery2.min.css rel=stylesheet type=text/css><script type=text/javascript src=https://unpkg.com/nanogallery2/dist/jquery.nanogallery2.min.js></script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js></script><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css integrity=sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.4.1.slim.min.js integrity=sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js integrity=sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo crossorigin=anonymous></script><script src=https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js integrity=sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6 crossorigin=anonymous></script><style media=screen>@font-face{font-family:nexa bold;src:url('/fonts/Nexa Bold.otf')}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}table{border-collapse:collapse;border-spacing:0}*,*:before,*:after{box-sizing:border-box}a,a:visited,a:focus,a:active{text-decoration:none}html{height:100%;font-size:16px}body{display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:-ms-flex;display:flex;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;align-items:center;-webkit-justify-content:flex-start;-moz-justify-content:flex-start;-ms-justify-content:flex-start;justify-content:flex-start;width:100%;min-height:100%;font-weight:400;color:#111;line-height:1.6;text-rendering:optimizeLegibility!important}.icon{text-rendering:geometricPrecision!important}section{-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;justify-content:center;align-items:center;width:100%;display:block;padding-bottom:0}section.header .content{align-items:center;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:-ms-flex;display:table;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;width:100%}section.header .logo{}section.header .name{font-size:50px;font-family:nexa bold,helvetica neue,arial,sans-serif;letter-spacing:.1rem;text-transform:uppercase;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-smoothing:antialiased;color:#333;color:#555}.left-div{display:table-cell;text-align:right;vertical-align:middle;width:50vw}.right-div{display:table-cell;text-align:left;width:50vw;vertical-align:middle}nav{width:100%;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;align-items:center;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;justify-content:center}nav ul li{color:#555;font-weight:400;font-size:14px;text-transform:uppercase;font-family:helvetica neue,arial,sans-serif;-webkit-transition:color .1s cubic-bezier(0.47,0,0.75,0.72);-moz-transition:color .1s cubic-bezier(0.47,0,0.75,0.72);-ms-transition:color .1s cubic-bezier(0.47,0,0.75,0.72);-o-transition:color .1s cubic-bezier(0.47,0,0.75,0.72)}nav ul li:hover{color:#111}.navbar-nav li:hover>ul.dropdown-menu{display:block}.dropdown-submenu{position:relative}.dropdown-submenu>.dropdown-menu{top:0;left:100%;margin-top:-6px}.dropdown-menu>li>a:hover:after{text-decoration:underline;transform:rotate(-90deg)}.search-box{text-align:center}section.footer{-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;align-items:center;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;justify-content:center;flex-direction:column-reverse;width:100%;text-align:center}section.footer a{font-size:14px;margin-left:6px;margin-right:6px;opacity:.6;-webkit-transition:opacity .1s cubic-bezier(0.47,0,0.75,0.72);-moz-transition:opacity .1s cubic-bezier(0.47,0,0.75,0.72);-ms-transition:opacity .1s cubic-bezier(0.47,0,0.75,0.72);-o-transition:opacity .1s cubic-bezier(0.47,0,0.75,0.72)}section.footer a:first-child{margin-left:0}section.footer a:last-child{margin-right:0}section.footer a:hover{opacity:.8}section.footer .icon{width:16px;height:16px}section.footer .copyright{flex-grow:.5;text-align:start}section.footer .icons{flex-grow:.5;text-align:end}section.main .container{-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;align-items:center;-webkit-justify-content:flex-start;-moz-justify-content:flex-start;-ms-justify-content:flex-start;justify-content:flex-start}section.main .content{color:#111;font-size:14px}section.main .content .title-container{display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:-ms-flex;display:flex;-webkit-justify-content:space-between;-moz-justify-content:space-between;-ms-justify-content:space-between;justify-content:space-between}section.main .content .posts{margin-bottom:4em}section.main .content .page-heading{font-size:20px;font-weight:700;font-family:helvetica neue,arial,sans-serif;letter-spacing:-.005rem;text-transform:uppercase;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-smoothing:antialiased;color:#333;margin-bottom:16px}section.main .content .front-matter .page-heading{margin-bottom:0}section.main .content .front-matter .updates-heading{font-size:17px;text-transform:uppercase;font-weight:600}section.main .content .front-matter .update-content{font-size:14px;color:#790202;margin-bottom:30px}section.main .content .front-matter .update-content li{margin-left:20px;list-style-type:circle}section.main .content .front-matter .meta{font-size:14px;color:#666;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:-ms-flex;display:flex;margin-bottom:10px}section.main .content .front-matter .date,section.main .content .front-matter .author,section.main .content .front-matter .tags,section.main .content .front-matter .word-count,section.main .content .front-matter .reading-time .middot{display:none}section.main .content .front-matter .middot{font-size:6px;margin:0 6px;display:inline;vertical-align:middle}section.main .content .front-matter .middot:before{content:"â€¢"}section.main .content .front-matter .tags ul{display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:-ms-flex;display:flex;-webkit-flex-direction:row;-moz-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;align-items:center}section.main .content .front-matter .tags ul li{-webkit-transition:opacity .1s cubic-bezier(0.47,0,0.75,0.72);-moz-transition:opacity .1s cubic-bezier(0.47,0,0.75,0.72);-ms-transition:opacity .1s cubic-bezier(0.47,0,0.75,0.72);-o-transition:opacity .1s cubic-bezier(0.47,0,0.75,0.72)}section.main .content .front-matter .tags ul li:hover{opacity:.7}section.main .content .front-matter .tags ul li a{color:#666}section.main .container.f04{-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;justify-content:center}section.main .container.f04 .content{display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:-ms-flex;display:flex;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;align-items:center}section.main .container.f04 .content .num{margin:30px 0 30px 0;font-weight:400;font-family:helvetica neue,arial,sans-serif;font-size:50px}section.main .container.f04 .content .detail{margin-bottom:40px}section.main .container .content .groupby{margin-top:1em;padding-left:.5em}section.main .container .content .post-item{display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:-ms-flex;display:flex;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;align-items:center;display:list-item;list-style:disc inside}section.main .container .content .post-item .meta{font-size:14px;color:#666;display:none;min-width:100px}section.main .container .content .see-more{font-style:italic;float:right;font-size:.9em;margin-top:2em;color:#313537}section.main .container .content .see-more:hover{color:#666}section{padding:0 16px}section.header-home{padding-top:36px}section.main{padding-top:32px;display:block}section.main .container .content .post-item .meta{display:block}section.main .container .content .post-item{display:flex;list-style:none}a{color:#428bca;-webkit-transition:color .1s cubic-bezier(0.47,0,0.75,0.72);-moz-transition:color .1s cubic-bezier(0.47,0,0.75,0.72);-ms-transition:color .1s cubic-bezier(0.47,0,0.75,0.72);-o-transition:color .1s cubic-bezier(0.47,0,0.75,0.72)}a:hover{color:#2a6496}img{max-width:100%}section.coverimage{width:100%;max-width:100%}section.main .content{width:100%}section.main .content .markdown{font-size:1.1em;line-height:1.75em;color:#313537;font-family:serif;font-weight:300}section.main .content .markdown h1,section.main .content .markdown h2,section.main .content .markdown h3,section.main .content .markdown h4,section.main .content .markdown h5,section.main .content .markdown h6{font-size:22px;font-family:helvetica neue,arial,sans-serif;letter-spacing:-.005rem;font-weight:700;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-smoothing:antialiased;color:#333;text-transform:none;margin-top:1.75rem}section.main .content .markdown h1{font-size:1.75rem;margin-bottom:2rem}section.main .content .markdown h2{font-size:1.5rem;margin-bottom:1.5rem}section.main .content .markdown h3{font-size:1em;margin-bottom:1rem}section.main .content .markdown h4,section.main .content .markdown h5,section.main .content .markdown h6{font-size:1rem;margin-bottom:1rem;letter-spacing:none}section.main .content .markdown code,section.main .content .markdown pre{font-family:menlo,monospace;font-size:.98rem;background-color:#f7f7f7}section.main .content .markdown code{padding:.15em .5em;border-radius:2px}section.main .content .markdown pre{display:block;margin-top:1rem;margin-bottom:2rem;padding:1rem;line-height:1.5em;white-space:pre;word-break:break-all;word-wrap:break-word}@media(min-width:769px){section.main .content .markdown pre{width:110%;margin-left:-4%}}section.main .content .markdown pre code{padding:0;font-size:.9rem}section.main .content .markdown a code{color:#428bca!important}section.main .content .markdown a code:hover{text-decoration:underline}section.main .content .markdown p{text-align:justify;margin-top:0;margin-bottom:1em}section.main .content .markdown ul,section.main .content .markdown ol,section.main .content .markdown dl{margin-top:1rem;margin-bottom:2rem}section.main .content .markdown dt{font-weight:700}section.main .content .markdown dd{margin-bottom:.5rem}section.main .content .markdown ul{list-style-type:disc;list-style-position:outside;margin-bottom:1.25rem}section.main .content .markdown ol{list-style-type:decimal;margin-bottom:1.25rem}section.main .content .markdown li{margin-left:2em}section.main .content .markdown em{font-style:italic}section.main .content .markdown strong{font-weight:700}section.main .content .markdown hr{position:relative;margin:1.75rem 0;border:0;border-top:1px solid gray;border-top:1px solid #999}section.main .content .markdown abbr{font-size:.85rem;font-weight:700;color:#666;text-transform:uppercase}section.main .content .markdown abbr[title]{cursor:help;border-bottom:1px dotted gray}section.main .content .markdown blockquote{padding:.5rem 1rem;margin:.8rem 0;color:#7a7a7a;border-left:.25rem solid #e5e5e5}section.main .content .markdown blockquote p:last-child{margin-bottom:0}section.main .content .markdown figure{width:100%;background:#fff;margin-bottom:1em}section.main .content .markdown figure img{width:100%;height:auto;max-width:100%;display:block;position:static;margin:auto}section.main .content .markdown table{margin-bottom:1rem;width:100%;border:1px solid #e5e5e5;border-collapse:collapse}section.main .content .markdown td,section.main .content .markdown th{padding:.25rem .5rem;border:1px solid #e5e5e5}section.main .content .markdown tbody tr:nth-child(odd) td,section.main .content .markdown tbody tr:nth-child(odd) th{background-color:#f7f7f7}section.main .content .markdown .footnotes ol{list-style-type:decimal;margin-left:16px}section.main .content .markdown .footnotes li{list-style-type:unset}section.main .content .markdown .footnote-ref{font-size:.7em}section.main .content .navigation{display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:-ms-flex;display:flex;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;align-items:center}section.main .content .navigation div{display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:-ms-flex;display:flex;-webkit-flex-direction:row;-moz-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;align-items:center;margin-top:1em}section.main .content .navigation .icon{width:16px;height:16px}section.main .content .navigation a{width:250px;margin-left:1em;text-align:center;font-style:italic;color:#313537}.breadcrumb{font-size:10px;background-color:transparent}.wf-raleway-n4-active body,.wf-raleway-n4-active section.header nav ul li,.wf-raleway-n7-active section.main .content .page-heading,.wf-raleway-n2-active section.main .container.f04 .content .num,.wf-raleway-n7-active section.main .content .markdown h1,.wf-raleway-n7-active section.main .content .markdown h2,.wf-raleway-n7-active section.main .content .markdown h3,.wf-raleway-n7-active section.main .content .markdown h4,.wf-raleway-n7-active section.main .content .markdown h5,.wf-raleway-n7-active section.main .content .markdown h6{font-family:raleway}.wf-merriweather-n3-active section.main .content .markdown{font-family:merriweather}.wf-ubuntu-mono-n4-active section.main .content .markdown code,.wf-ubuntu-mono-n4-active section.main .content .markdown pre{font-family:ubuntu mono}.no-padding{padding-left:0;padding-right:0;height:200px}<`2`><`2`><`2`><`2`></style><style media="(min-width: 1024px)">body{-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;justify-content:center}.non-narrow.zero-top-spacing{padding-top:0!important}section{padding:0 16px;margin-left:10%;margin-right:10%;max-width:80%}section.header{background-color:transparent}section.header .container{-webkit-justify-content:flex-start;-moz-justify-content:flex-start;-ms-justify-content:flex-start;justify-content:flex-start}section.header .container .logo{margin:0}section.header-home .container .logo{max-width:180px;margin-left:20px}section.header-home .name-home{padding-top:30px;font-size:40px}section.header-home nav ul li{font-size:18px}section.header .content{-webkit-align-items:flex-start;-moz-align-items:flex-start;-ms-align-items:flex-start;align-items:flex-start}section.header .name{color:#333}section.header nav{font-size:14px;margin-bottom:0}section.header nav ul{text-align:left}section.header nav ul li{color:#666}section.header nav ul li:hover{color:#333}section.footer{background-color:transparent}section.footer .container{flex-direction:row}section.footer .container a{margin-left:3px;margin-right:3px;color:#666}section.footer .container a:hover{color:#333}section.footer .container a .icon{font-size:18px}section.footer .container a .icon.larger{font-size:20px}section.main .content .front-matter .date,section.main .content .front-matter .author,section.main .content .front-matter .tags,section.main .content .front-matter .word-count,section.main .content .front-matter .reading-time .middot{display:initial}section.main .container.f04{-webkit-justify-content:flex-start;-moz-justify-content:flex-start;-ms-justify-content:flex-start;justify-content:flex-start}section.main .container.f04 .content{-webkit-align-items:flex-start;-moz-align-items:flex-start;-ms-align-items:flex-start;align-items:flex-start}section.main .container.f04 .content .num{margin:0 0 10px;font-size:32px}section.main .container.f04 .content .detail{margin-bottom:30px}.container{padding:0 30px}section.header{padding-top:60px;padding-bottom:10px}section.footer{padding-top:30px;padding-bottom:60px}section.main{padding-top:0}section.main .container .content .post-item{display:flex;list-style:none;padding-left:1.5em}section.main .container .content .post-item .meta{display:block}section.main.post{padding-top:60px;padding-bottom:60px}section.main .content .markdown blockquote{padding-right:5rem;padding-left:1.25rem}section.main .content .navigation{-webkit-flex-direction:row;-moz-flex-direction:row;-ms-flex-direction:row;flex-direction:row}section.main .content .navigation div{margin-top:0}</style><style media="(min-width: 1500px)">section{padding:0 16px;margin-left:10%;margin-right:10%;max-width:1024px}section.main .content .markdown figure{width:110%;margin-left:-4%}section.main .content .markdown img{max-width:110%;width:110%;margin-left:-4%}</style><noscript><link href="https://fonts.googleapis.com/css?family=Raleway:400,600,700" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700" rel=stylesheet></noscript><style type=text/css media=screen>.hljs{display:block;background:#fff;padding:.5em;color:#333;overflow-x:auto}.hljs-comment,.hljs-meta{color:#969896}.hljs-string,.hljs-variable,.hljs-template-variable,.hljs-strong,.hljs-emphasis,.hljs-quote{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-literal,.hljs-symbol,.hljs-bullet,.hljs-attribute{color:#0086b3}.hljs-section,.hljs-name{color:#63a35c}.hljs-tag{color:#333}.hljs-title,.hljs-attr,.hljs-selector-id,.hljs-selector-class,.hljs-selector-attr,.hljs-selector-pseudo{color:#795da3}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}</style><style type=text/css media=screen>.progressive{overflow:hidden;position:relative;background:#efefef}.progressive__img{width:100%;height:100%;position:absolute;-webkit-transform:translateZ(0);transform:translateZ(0)}.progressive--not-loaded{filter:blur(30px);-webkit-filter:blur(30px)}.progressive--is-loaded{filter:blur(20px);-webkit-filter:blur(20px);-webkit-animation:sharpen .5s both;animation:sharpen .5s both}@-webkit-keyframes sharpen{from{filter:blur(20px);-webkit-filter:blur(20px)}to{filter:blur(0);-webkit-filter:blur(0)}}@keyframes sharpen{from{filter:blur(20px);-webkit-filter:blur(20px)}to{filter:blur(0);-webkit-filter:blur(0)}}</style><style type=text/css media=screen>a{color:#527fc1f}a:hover{color:#1a3152}section.main .content .markdown,section.header .name,section.header nav ul li:hover{color:#181d2a}section.header nav ul li{color:#6a7a8b}section.main .content .markdown code{background-color:#f9f9f9;color:#527fc1f}section.main .content .markdown pre,section.main .content .markdown pre code{background-color:#282a36;color:#87a5d2}.hljs,.hljs-subst,.hljs-variable{color:#87a5d2}.hljs-type{color:#97d28b}.hljs-quote{color:#ffcb8d}.hljs-string,.hljs-number,.hljs-selector-id,.hljs-selector-class,.hljs-template-tag,.hljs-deletion{color:#96c2d7}.hljs-comment{color:#6a7a8b}.hljs-regexp,.hljs-symbol,.hljs-template-variable{color:#ffcb8d}.hljs-keyword,.hljs-attribute,.hljs-meta-keyword,.hljs-doctag,.hljs-name{color:#97d28b}.hljs-link,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-title,.hljs-section{color:#ff8e91}.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-addition{color:#97d28b}</style><link rel=stylesheet href=https://www.huynle.com/css/custom.css><link rel="shortcut icon" href=https://www.huynle.com/img/favicon.png><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-41899218-5','auto');ga('send','pageview');}</script></head><body><section class=header><div><div class=left-div><a href=https://www.huynle.com/ class=logo><img src=https://www.huynle.com/img/favicon.png alt=logo></a></div><div class=right-div><a href=https://www.huynle.com/ class=name>Huy Le</a></div></div><nav class="navbar navbar-expand-lg navbar-light bg-light rounded"><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarc aria-controls=navbarsExample10 aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse justify-content-md-center" id=navbarc><ul class=navbar-nav><li class="nav-item active"><a class=nav-link href=https://www.huynle.com/thoughts>thoughts</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=http://example.com id=navbarDropdownMenuLink data-toggle=dropdown aria-haspopup=true aria-expanded=false>projects</a><ul class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><li class=dropdown-item><a href=https://www.huynle.com/projects/>All</a></li><li class=dropdown-submenu><a class="dropdown-item dropdown-toggle" href=https://www.huynle.com/projects/custom-vim/>Custom Vim</a></li><li class=dropdown-submenu><a class="dropdown-item dropdown-toggle" href=https://www.huynle.com/projects/flamewheel-450/>DJI Flamewheel 450</a></li><li class=dropdown-submenu><a class="dropdown-item dropdown-toggle" href=https://www.huynle.com/projects/k40-laser/>K40-Laser</a></li><li class=dropdown-submenu><a class="dropdown-item dropdown-toggle" href=https://www.huynle.com/projects/k8200/>K8200</a></li><li class=dropdown-submenu><a class="dropdown-item dropdown-toggle" href=https://www.huynle.com/projects/px4/>PX4</a></li><li class=dropdown-submenu><a class="dropdown-item dropdown-toggle" href=https://www.huynle.com/projects/ilawn/>iLawn</a></li><li class=dropdown-submenu><a class="dropdown-item dropdown-toggle" href=https://www.huynle.com/projects/esp/>ESP MCU</a></li></ul></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=http://example.com id=navbarDropdownMenuLink data-toggle=dropdown aria-haspopup=true aria-expanded=false>learnings</a><ul class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><li class=dropdown-item><a href=https://www.huynle.com/learnings/>All</a></li><li class=dropdown-submenu><a class="dropdown-item dropdown-toggle" href=https://www.huynle.com/learnings/resources/>Resources</a></li><li class=dropdown-submenu><a class="dropdown-item dropdown-toggle" href=https://www.huynle.com/learnings/essentials/>Essentials</a></li><li class=dropdown-submenu><a class="dropdown-item dropdown-toggle" href=https://www.huynle.com/learnings/cpp/>Learning C++</a></li></ul></li><li class="nav-item active"><a class=nav-link href=https://www.huynle.com/adventures>adventures</a></li><li class="nav-item active"><a class=nav-link href=https://www.huynle.com/about/>About</a></li><li class="nav-item active"><a class=nav-link href=https://www.huynle.com/search/>Search</a></li></ul></div></nav><div class=search-box><form action=https://www.huynle.com/search/><input id=search-query name=q></form></div></section><div><ol class=breadcrumb><li><a href=https://www.huynle.com/>HOME</a></li><li><a href=https://www.huynle.com/projects/>PROJECTS</a></li><li><a href=https://www.huynle.com/projects/k40-laser/>K40-LASER</a></li><li>UPGRADING K40 CONTROLLER</li></ol></div><section class=coverimage></section><section class="main post non-narrow zero-top-spacing"><div class=content><div class=front-matter><div class=title-container><div class=page-heading>Upgrading K40 Controller</div></div><div class=meta><div class=date title="Fri May 3 2019 22:43:29 -0600">May 3, 2019</div><div class=reading-time><div class=middot></div>5 minute read</div></div><div><ul class=update-content></ul></div></div><div class=markdown><h1 id=k40-laser-engraver>K40 Laser Engraver</h1><h2 id=upgrades>Upgrades</h2><h3 id=add-switch-to-change-between-manual-power-and-pwm-power>Add Switch to change between manual power, and PWM power</h3><ul><li>add in a switch to switch between a potentiometer and the PWM power from the laser for the IN line on LPS&rdquo;</li><li>K40 Laser Engraver</li></ul><h3 id=controller-board-upgrades>Controller Board Upgrades</h3><ul><li><p>PiBot</p><ul><li>Raspberry Pi CNC Hat V2.60 - GRBL v1.1 Compatable - Uses Pololu Stepper Drivers<ul><li>Look for this 2.6V</li><li><a href="https://www.ebay.com/itm/Raspberry-Pi-CNC-Hat-V2-60-GRBL-v1-1-Compatable-Uses-Pololu-Stepper-Drivers/271901344091?hash=item3f4e95415b:g:bhsAAOSwZLZaTWn~">https://www.ebay.com/itm/Raspberry-Pi-CNC-Hat-V2-60-GRBL-v1-1-Compatable-Uses-Pololu-Stepper-Drivers/271901344091?hash=item3f4e95415b:g:bhsAAOSwZLZaTWn~</a></li></ul></li></ul></li><li><p>Smoothieboard - fork off GRBL</p><ul><li>MKS for chinese clone - wont exactly work since smoothieboard is at 120mHz, and MKS is at 100Mhz</li></ul></li><li><p>TinyG</p></li><li><p>GRBL</p><ul><li>Can run GRBL-LPC on a smoothieboard (LPCExpression 32-bit board)</li><li>Sainsmart</li></ul></li><li><p>GRBL-LPC - running on 32bit - CPREZZI works without mods for MKS SBASE V1.3</p><ul><li><a href=https://github.com/LaserWeb/LaserWeb4/wiki/2.2-Initial-Configuration---GRBL-LPC-1.1>https://github.com/LaserWeb/LaserWeb4/wiki/2.2-Initial-Configuration---GRBL-LPC-1.1</a></li><li><a href=https://github.com/gnea/grbl/tree/master/doc/markdown>https://github.com/gnea/grbl/tree/master/doc/markdown</a></li><li>supported by laserweb?</li><li><a href=https://github.com/gnea/grbl-LPC>https://github.com/gnea/grbl-LPC</a><ul><li>More updated version? <a href=https://github.com/cprezzi/grbl-LPC>https://github.com/cprezzi/grbl-LPC</a></li></ul></li><li>works with MKS SBASE - MKS SBase boards LPC1768<ul><li>pinout for MKS board - <a href=https://ae01.alicdn.com/kf/HTB1j9yDRpXXXXXOaFXXq6xXFXXX9/MKS-SBASE-V1-3-3d-drucker-controller-32bit-Arm-plattform-Glatte-steuerkarte-open-source-MCU-LPC1768.jpg>https://ae01.alicdn.com/kf/HTB1j9yDRpXXXXXOaFXXq6xXFXXX9/MKS-SBASE-V1-3-3d-drucker-controller-32bit-Arm-plattform-Glatte-steuerkarte-open-source-MCU-LPC1768.jpg</a></li><li>SUPPORTING DOCS<ul><li><a href=https://github.com/gnea/grbl-LPC/issues/5>https://github.com/gnea/grbl-LPC/issues/5</a></li><li>finding PWM pin - <a href=https://github.com/gnea/grbl-LPC/issues/12>https://github.com/gnea/grbl-LPC/issues/12</a></li></ul></li></ul></li><li>video<ul><li><a href="https://www.youtube.com/watch?v=jv0lxEan_Xw">https://www.youtube.com/watch?v=jv0lxEan_Xw</a> - GRBL 1.1 on smoothieware</li><li>STEPS for stepper &lsquo;> Would love to know how accurate it prints at 500mm/s. With stock steppers, 19.757 and 157.905 steps per unit works well for me. Using grbl 1.1 but on ramps. Either way, you have a nice setup.&rsquo;</li></ul></li></ul></li><li><p>MKS SBASE board on smoothieware</p><ul><li><a href=https://www.instructables.com/id/Configuring-MKS-Sbase-V12-32-bit-Controller-Basics/>https://www.instructables.com/id/Configuring-MKS-Sbase-V12-32-bit-Controller-Basics/</a></li></ul></li><li><p>Interfaces to control the printer</p><ul><li><a href=https://github.com/LaserWeb/LaserWeb4-Binaries/>https://github.com/LaserWeb/LaserWeb4-Binaries/</a></li></ul></li></ul><h3 id=install-an-current-meter-to-k40-laser>install an current meter to k40 laser</h3><ul><li><a href=https://k40laser.se/diy-how-to/install-ma-meter-k40-laser/>https://k40laser.se/diy-how-to/install-ma-meter-k40-laser/</a></li></ul><h4 id=sainsmart-board>Sainsmart board</h4><ul><li>Good article to get this board going<ul><li><a href=https://www.reddit.com/r/lasercutting/comments/awe5na/how_to_wire_a_grbl_v11_laser_controller_to_a_ttl/>https://www.reddit.com/r/lasercutting/comments/awe5na/how_to_wire_a_grbl_v11_laser_controller_to_a_ttl/</a></li><li><a href=https://www.reddit.com/r/lasercutting/comments/awyrb6/issue_wiring_grbl_11_controller_to_laser_power/>https://www.reddit.com/r/lasercutting/comments/awyrb6/issue_wiring_grbl_11_controller_to_laser_power/</a></li><li><a href=https://www.reddit.com/r/ChineseLaserCutters/comments/bci7az/just_finished_my_k40_and_im_looking_for_some/>https://www.reddit.com/r/ChineseLaserCutters/comments/bci7az/just_finished_my_k40_and_im_looking_for_some/</a><ul><li>Go down a read a couple of posts to find the details</li></ul></li><li>Flash using Arduino IDE, UNO board!</li></ul></li></ul><h3 id=good-wiki-to-read-through>Good Wiki to read through</h3><ul><li><a href=https://www.reddit.com/r/lasercutting/wiki/k40%22>https://www.reddit.com/r/lasercutting/wiki/k40"</a></li></ul><h2 id=focusing--length-and-beam>Focusing Length and Beam</h2><h3 id=learn-how-to-focus-lens>Learn how to focus lens!</h3><p><a href="https://www.youtube.com/watch?v=Eg6THrEdleo%22">https://www.youtube.com/watch?v=Eg6THrEdleo"</a></p><h2 id=mks-sbase-v13-board>MKS SBASE V1.3 Board</h2><p>Chinese Board that has NXR LPC1768, running at 100MHz</p><ul><li><p>documentation can be found here for this board</p><ul><li><a href=https://github.com/makerbase-mks/MKS-SBASE>https://github.com/makerbase-mks/MKS-SBASE</a></li></ul></li><li><p>Should work out of the box with GRBL?</p><ul><li>Need to set the stepping for the stepper motor for the correct distance?</li></ul></li></ul><h3 id=setting-power-with-pot>Setting power with pot!</h3><p>-&ldquo;&ldquo;If you like to additionally adjust the maximum laser power with a potentiometer you can connect a pot of around 10kOhm instead of the direct connection between pin IN and 5V on the laser power supply.&rdquo;&rdquo;</p><h3 id=potential-issue>Potential Issue</h3><ul><li>not connecting to internet<ul><li><a href=https://github.com/makerbase-mks/MKS-SBASE/issues/48>https://github.com/makerbase-mks/MKS-SBASE/issues/48</a><ul><li>Ethernet is not powered, need to jump a trace</li></ul></li></ul></li><li>networking issue?<ul><li>settings here for smoothieware<ul><li><a href=https://github.com/makerbase-mks/MKS-SBASE/issues/82>https://github.com/makerbase-mks/MKS-SBASE/issues/82</a></li></ul></li></ul></li></ul><h3 id=final-configurations>Final Configurations</h3><h4 id=grbl-settings>GRBL Settings</h4><ul><li>Note that GRBL-LPC has more settings than just GRBL<ul><li>particularly $140, $141, $142 for current settings for the stepper motors</li><li>additionally, the $30, and $31</li></ul></li></ul><h4 id=lightburn-settings>lightburn settings</h4><ul><li>USB devices<ul><li>use &ldquo;&ldquo;rear left&rdquo;&rdquo;</li></ul></li><li>Settings window<ul><li>use top-left radial button</li></ul></li><li>Device Settings for <code>USB device name here</code><ul><li>use top-left radial button also</li><li>S-value should be 1000 here. to match the value of $30 in GRBL settings. this gives us full control through software.</li></ul></li></ul><pre><code>$$
$0=10
$1=25
$2=0
$3=1
$4=0
$5=1
$6=0
$10=0
$11=0.010
$12=0.002
$13=0
$20=1
$21=1
$22=1
$23=3
$24=50.000
$25=1000.000
$26=250
$27=1.000
$30=1000
$31=0
$32=1
$33=5000.000
$34=0.000
$35=12.000
$36=100.000
$100=158.000
$101=158.000
$102=158.000
$103=158.000
$110=24000.000
$111=24000.000
$112=24000.000
$113=24000.000
$120=2500.000
$121=2500.000
$122=2500.000
$123=2500.000
$130=300.000
$131=200.000
$132=50.000
$133=100.000
$140=0.600
$141=0.600
$142=0.000
$143=0.000
ok
</code></pre><h3 id=sainsmart-board---ryc-grbl-v2>Sainsmart Board - ryc-grbl-v2</h3><ul><li>GRBL has been optimized for Ardunio&rsquo;s ATmega328p</li></ul><h3 id=about-the-firmware-grbl-11>About the firmware GRBL 1.1</h3><ul><li>Laser Mode<ul><li><a href=https://github.com/gnea/grbl/wiki/Grbl-v1.1-Laser-Mode>https://github.com/gnea/grbl/wiki/Grbl-v1.1-Laser-Mode</a><ul><li>enabling it will require you to send Grbl <code>$32=1</code> command</li></ul></li></ul></li></ul><h3 id=good-overall-tutorial-here>Good overall tutorial here</h3><p><a href=http://www.oak600.com/2018/03/19/upgrading-a-k40-laser-cutter-part-1-control-board-upgrade/>http://www.oak600.com/2018/03/19/upgrading-a-k40-laser-cutter-part-1-control-board-upgrade/</a>
Has all the settings..</p><p>(if empty in Our Value, then it uses the default)</p><pre><code>Option	Meaning	Default Value	Our Value
$0	Step Pulse (us)	10	
$1	Step Idle Delay (ms)	25	
$2	Step Port Invert mask	0	
$3	Direction Port Invert Mask	0	
$4	Step Enable Invert, bool	0	
$5	Limit Pins Invert, bool	0	
$6	Probe Pin Invert, bool	0	
$10	Status Report Mask	1	
$11	Junction Deviation (mm)	0.010	
$12	Arc Tolerance (mm)	0.002	
$13	Report Inches, bool	0	
$20	Soft Limits, bool	0	
$21	Hard Limits, bool	0	
$22	Homing Cycle, bool	1	0
$23	Homing Dir Invert Mask	0	
$24	Homing Feed (mm/min)	25.000	
$25	Homing Seek (mm/min)	500.000	
$26	Homing Debounce (ms)	250	
$27	Homing Pull-Off (mm)	1.000	
$30	Max Spindle Speed/Laser Strenght (1/10 rpm/%)	1000	
$31	Min Spindle Speed/Laser Strength (1/10 rpm/%)	0	50
$32	Laser Mode, bool	0	1
$100	X Steps/mm	250.000	158.000
$101	Y Steps/mm	250.000	158.000
$102	Z Steps/mm	250.000	158.000
$110	X Max Speed (mm/min)	500.000	50000.000
$111	Y Max Speed (mm/min)	500.000	50000.000
$112	Z Max Speed (mm/min)	500.000	50000.000
$120	X Accel (mm/sec&amp;2)	10	300
$121	Y Accel (mm/sec^2)	10	300
$122	Z Accel (mm/sec^2)	10	300
$130	X Max Travel (mm)	200.000	
$131	Y Max Travel (mm)	200.000	
$132	Z Max Travel (mm)	200.000
</code></pre><h3 id=need-to-enable-laser-pin>need to enable laser pin</h3><ul><li>inverting the pwm signal with hardware
<a href=https://github.com/gnea/grbl/issues/22>https://github.com/gnea/grbl/issues/22</a></li></ul><h3 id=flashing>Flashing</h3><ul><li>use Arduino IDE, and UNO board (indeed has a ATmega328p)<ul><li>success from user in Amazon review</li></ul></li></ul><h3 id=worked-on>Worked on</h3><ul><li>Negative Homing<ul><li><a href=https://github.com/grbl/grbl/wiki/Frequently-Asked-Questions#why-is-grbl-in-all-negative-coordinates-after-homing-or-it-so-annoying-and-not-what-im-used-to>https://github.com/grbl/grbl/wiki/Frequently-Asked-Questions#why-is-grbl-in-all-negative-coordinates-after-homing-or-it-so-annoying-and-not-what-im-used-to</a></li><li>had to set a var in the config.h file and recompiled</li><li><code>HOMING_FORCE_SET_ORIGIN</code> uncommented out in code, allow for machine to zero, zero when homed<ul><li>this is not default, because of the legacy of CNC machines. GRBL wanted to keep it consistent</li></ul></li></ul></li><li>Homing Switches<ul><li>Had to invert $5</li></ul></li><li>Motor speed - in mm/min not mm/s<ul><li>setting the motors speed limit on Lightburn, watch for mm/min vs mm/s</li></ul></li><li>Change laser enable pin to Z+ (limit switch in code)<ul><li>change in source to take on the Z+ as the pin</li></ul></li><li>Min &ldquo;&ldquo;Spindle&rdquo;&rdquo; speed - 25 - allow to cut through corners<ul><li>or else, the corners wont be cuts</li><li>ideally, we want to to set this value to be minimum as possible to reduce burn in the corners</li></ul></li><li>Weak power control<ul><li>S-power setting in Lightburn gets changed to 2000, twice that of the $30 value in GRBL of 1000</li><li>S-power setting is in Edit->Device Settings</li><li>This 2000 is doubled of the 1000 value, which is the limit set in the config.h file</li></ul></li></ul><h3 id=final-configuration>FINAL CONFIGURATION</h3><pre><code>$0=10
$1=25
$2=0
$3=2
$4=0
$5=1
$6=0
$10=1
$11=0.010
$12=0.002
$13=0
$20=0
$21=1
$22=1
$23=3
$24=25.000
$25=1000.000
$26=250
$27=1.000
$30=1000
$31=50
$32=1
$100=158.000
$101=158.000
$102=158.000
$110=3000.000
$111=3000.000
$112=3000.000
$120=300.000
$121=300.000
$122=200.000
$130=300.000
$131=200.000
$132=200.000
</code></pre><h2 id=settings-for-lightburn-cuts>Settings for LightBurn Cuts</h2><h3 id=grayscale-on-plywood>Grayscale on Plywood</h3><ul><li>Speed: 65mm/s</li><li>Max Power: 0.75</li><li>DPI: 750</li><li>Overscanning: 2.5%&rdquo;</li></ul><br></div><div class=navigation><div style=width:100%></div><div><a href=https://www.huynle.com/projects/sainsmart-ryc-grbl-v2-upgrade/>Sainsmart RYC GRBL V2 Upgrade</a>
<img class=icon src=https://www.huynle.com/img/next.svg alt=next></div></div><br></div></section><section class="container-fluid footer"><div class=copyright><a href=https://www.huynle.com/license>Copyright Â© 2017 Huy Le</a></div><div class=icons><a href=https://github.com/huynle target=_blank><img class=icon src=https://www.huynle.com/img/github.svg alt=github></a>
<a href=https://twitter.com/huynle target=_blank><img class=icon src=https://www.huynle.com/img/twitter.svg alt=twitter></a>
<a href=https://www.linkedin.com/in/huynle target=_blank><img class=icon src=https://www.huynle.com/img/linkedin.svg alt=linkedin></a>
<a href=mailto:dacrazyazn@gmail.com><img class=icon src=https://www.huynle.com/img/email.svg alt=email></a>
<a href=https://www.huynle.com/index.xml><img class=icon src=https://www.huynle.com/img/rss.svg alt=rss></a></div></div></section><script src=https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js></script><script>WebFont.load({google:{families:['Raleway:400,600,700','Merriweather:300,300i,700,700i','Ubuntu+Mono:400,700']}});</script><script src=https://www.huynle.com/js/highlight.min.js defer></script><script src=https://www.huynle.com/js/progressively.min.js defer></script><script>window.onload=function(){hljs.initHighlighting();progressively.init({delay:30,throttle:50});};</script></body></html>